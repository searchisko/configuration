{
  "id" : "jbossorg_federated_accounts",
  "description" : "Query federated profiles data from jbossorg SSO. Accepts the following parameters: 'query', 'contributor'.",
  "default" : {
    "sys_type" : "sso_federation"
  },
  "template" : "{\r\n  \"size\":0,\r\n  \"query\" : {\r\n    \"filtered\": {\r\n      \"filter\" : {\r\n        \"and\": {\r\n          \"filters\": [\r\n            {{#provider}}\r\n            {\r\n              \"term\" : { \"provider\" : \"{{provider}}\" }\r\n            },\r\n            {{\/provider}}\r\n            {{#active}}\r\n            {\r\n              \"term\" : { \"active\" : {{active}} }\r\n            },\r\n            {{\/active}}\r\n            {{#with_new_account}}\r\n            {\r\n              \"term\" : { \"with_new_account\" : {{with_new_account}} }\r\n            },\r\n            {{\/with_new_account}}\r\n            {{#date_from}}\r\n            {\r\n              \"range\": {\r\n                \"{{date_field}}{{^date_field}}sys_created{{\/date_field}}\": {\r\n                  \"gte\": \"{{date_from}}\",\r\n                  \"time_zone\" : \"{{timezone_offset}}{{^timezone_offset}}America\/New_York{{\/timezone_offset}}\"\r\n                }\r\n              }\r\n            },\r\n            {{\/date_from}}\r\n            {{#date_to}}\r\n            {\r\n              \"range\": {\r\n                \"{{date_field}}{{^date_field}}sys_created{{\/date_field}}\": {\r\n                  \"lt\": \"{{date_to}}\",\r\n                  \"time_zone\" : \"{{timezone_offset}}{{^timezone_offset}}America\/New_York{{\/timezone_offset}}\"\r\n                }\r\n              }\r\n            },\r\n            {{\/date_to}}\r\n            {}\r\n          ]\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \"aggs\" : {\r\n    \"bucketed\" : {\r\n    \"date_histogram\" : {\r\n      \"field\" : \"{{date_field}}{{^date_field}}sys_created{{\/date_field}}\",\r\n      \"interval\" : \"{{interval}}{{^interval}}month{{\/interval}}\",\r\n      \"format\": \"{{bucket_key_format}}{{^bucket_key_format}}yyyy-MM{{\/bucket_key_format}}\",\r\n      \"pre_zone\" : \"{{timezone_offset}}{{^timezone_offset}}America\/New_York{{\/timezone_offset}}\"\r\n    }\r\n    }\r\n  }\r\n}"
}