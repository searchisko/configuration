{
  "id": "developer_materials",
  "description": "Developer material finder. Accepts the following parameters: 'from', 'query', 'query_highlight', 'size10', 'size15', 'size20', 'size25', 'size50', 'size100', 'level', 'tag', 'publish_date_from', 'publish_date_to', 'activity_interval','activity_date_from', 'activity_date_to', 'rating', 'sys_type', 'type', 'project', 'randomized', 'seed', 'newFirst', 'oldFirst'",
  "default": {
    "sys_content_type": [ "jbossdeveloper_event","jbossorg_sbs_forum","stackoverflow_question","jbossdeveloper_quickstart","jbossdeveloper_demo","jbossdeveloper_bom","jbossdeveloper_archetype","jbossdeveloper_example","jbossdeveloper_vimeo","jbossdeveloper_youtube","jbossdeveloper_book","rht_knowledgebase_article","rht_knowledgebase_solution","jbossorg_blog" ]
  },
  "override" : {
    "sys_content_type" : "type"
  },
  "template": "{\n      \"from\": {{#from}}{{from}}{{/from}}{{^from}}0{{/from}},\n      \"size\": 10,\n      {{#size15}}\"size\": 15,{{/size15}}\n      {{#size20}}\"size\": 20,{{/size20}}\n      {{#size25}}\"size\": 25,{{/size25}}\n      {{#size50}}\"size\": 50,{{/size50}}\n      {{#size100}}\"size\": 100,{{/size100}}\n      \"fields\": [\n        \"contributors\", \"duration\", \"experimental\", \"github_repo_url\", \"level\", \"sys_author\", \"sys_contributors\",\n        \"sys_created\", \"sys_description\", \"sys_rating_avg\", \"sys_rating_num\", \"sys_title\", \"sys_type\",\n        \"sys_url_view\", \"thumbnail\", \"sys_tags\",\"sys_content_plaintext\", \"target_product\"\n      ],\n \"indices_boost\": { \"data_rht_website\": 3  },\n   {{#query_highlight}}\n      \"highlight\" : {\n        \"pre_tags\" : [\"<span class='hlt'>\"],\n        \"post_tags\" : [\"</span>\"],\n        \"fields\" : {\n            \"sys_title\" : {},\n            \"sys_content_plaintext\" : {},\n            \"sys_description\" : {}\n        }\n      },\n      {{/query_highlight}}   \"query\": {\n        \"function_score\": {\n          \"query\": {\n            \"filtered\": {\n              {{#query}}\n              \"query\": {\n                \"simple_query_string\": {\n                  \"query\": \"{{query}}\",\n                  \"fields\": [\n                    \"sys_description\", \"sys_tags\", \"sys_contributors.fulltext\", \"sys_project_name\",\"sys_title\",\"sys_content_plaintext\",\"answers.body\" \n                  ]\n                }\n              },\n              {{/query}}\n              \"filter\": {\n                \"and\": {\n                  \"filters\": [\n            {{#blogbyurl}}\n                    {\n                      \"or\": [\n                    {\n                      \"not\": {\n                        \"term\": { \"sys_type\" : \"blogpost\" }\n                      }\n                    },\n                    {\n                      \"and\": [\n                          {\"term\":{\"sys_url_view\":\"{{blogbyurl}}\"}},\n                          {\"term\":{\"sys_type\":\"blogpost\"}},\n\n                          {}\n                        ]\n                      },\n                        {}\n                      ]\n                    },\n                    {{/blogbyurl}}\n         {{#level}}\n                    {\n                      \"term\": {\n                        \"level\": \"{{level}}\"\n                      }\n                    },\n                    {{/level}}\n           {{#tags_or_logic}}\n                    {\n                      \"or\": [\n                    {{/tags_or_logic}}\n                      {{#tag}}\n                      {\n                        \"term\": { \"sys_tags\": [\"{{.}}\"] }\n                      },\n                      {{/tag}}\n                    {{#tags_or_logic}}\n                      {}\n                      ]\n                    },\n                    {{/tags_or_logic}}\n             {{#publish_date_from}}\n                    {\n                      \"range\": {\n                        \"sys_created\": {\n                          \"gte\": \"{{publish_date_from}}\"\n                        }\n                      }\n                    },\n                    {{/publish_date_from}}\n          {{#publish_date_to}}\n                    {\n                      \"range\": {\n                        \"sys_created\": {\n                          \"lte\": \"{{publish_date_to}}\"\n                        }\n                      }\n                    },\n                    {{/publish_date_to}}\n          {{#activity_interval}}\n                    {\n                      \"range\": {\n                        \"sys_activity_dates\": {\n                          \"gte\": \"{{activity_interval}}\"\n                        }\n                      }\n                    },\n                    {{/activity_interval}}\n          {{#activity_date_from}}\n                    {\n                      \"range\": {\n                        \"sys_activity_dates\": {\n                          \"gte\": \"{{activity_date_from}}\"\n                        }\n                      }\n                    },\n                    {{/activity_date_from}}\n                    {{#activity_date_to}}\n                    {\n                      \"range\": {\n                        \"sys_activity_dates\": {\n                          \"lte\": \"{{activity_date_to}}\"\n                        }\n                      }\n                    },\n                    {{/activity_date_to}}\n                    {{#rating}}\n                    {\n                      \"range\": {\n                        \"sys_rating_avg\": {\n                          \"gte\": \"{{rating}}\"\n                        }\n                      }\n                    },\n                    {{/rating}}\n                    {\n                      \"or\": [\n                        {{#sys_type}}\n                        {\n                          \"script\": {\n                            \"script\": \"(format_selection == 'quickstart_early_access' && _source.sys_type == 'quickstart' && _source.experimental != undefined && _source.experimental != null && _source.experimental === true) || (format_selection == 'quickstart' && _source.sys_type == format_selection && _source.experimental !== true) || (format_selection != 'quickstart' && format_selection != 'quickstart_early_access' && _source.sys_type == format_selection)\",\n                            \"params\": {\n                              \"format_selection\": \"{{.}}\",\n                              \"lang\": \"js\"\n                            }\n                          }\n                        },\n                        {{/sys_type}}\n                        {}\n                      ]\n                    },\n                    {\n                      \"or\": [\n                        {{#project}}\n                        {\n                            \"term\": { \"sys_project\": \"{{.}}\" }\n                        },\n                        {{/project}}\n                        {}\n                      ]\n                    },\n                    {\n                      \"terms\": {\n                        \"sys_content_provider\": [\n                          \"jboss-developer\",\"stackoverflow\",\"jbossorg\", \"rht\"\n                        ]\n                      }\n                    }\n                  ]\n                }\n              }\n            }\n          }\n      {{#randomized}}\n          ,\"functions\": [\n            {\n              \"random_score\": { \"seed\": \"{{#seed}}{{seed}}{{/seed}}{{^seed}}default{{/seed}}\" }\n            }\n          ]\n      }\n      }\n {{/randomized}}\n{{^randomized}}\n          ,\"boost_mode\":\"multiply\",\n          \"functions\": [\n              {\n                  \"filter\" : {\n                      \"term\" : { \"sys_title\" : \"topic\"}\n                  },\n                  \"weight\":2.5\n              },\n              {\n                  \"filter\" : {\n                      \"query\" : {\n                          \"match\" : { \n                              \"sys_title\" : {\n                                  \"query\" : \"About Us\",\n                                  \"operator\" : \"and\"\n                              }\n                          }\n                      }\n                  },\n                  \"script_score\" : {\n                      \"params\" : {\n                          \"query_param\" : \"{{query}}\",\n                          \"expected_phrase\" : \"red hat developers\"\n                      },\n                      \"script\" : \"query_param.toLowerCase()==expected_phrase ? 100 : 1;\"\n                  }\n              },\n       {\n              \"filter\" : {\n                \"term\" : { \n                  \"sys_url_view\" : \"rhel\"\n                }\n              },\n              \"script_score\" : {\n                \"params\" : {\n                  \"query_param\" : \"{{query}}\",\n                  \"expected_phrase\" : \"enterprise linux\"\n                },\n                \"script\" : \"query_param.toLowerCase()==expected_phrase ? 2.5 : 1;\"\n              }\n            }          ]\n       }\n      }\n      ,\"sort\": [\n        {{#newFirst}} { \"sys_created\": \"desc\" } {{/newFirst}}\n        {{#oldFirst}} { \"sys_created\": \"asc\" } {{/oldFirst}}\n       {{^newFirst}}{{^oldFirst}} \"_score\" {{/oldFirst}}{{/newFirst}}   \n      ]\n      {{/randomized}}\n      ,\n      \"aggregations\": {\n        \"format\": {\n          \"global\": {},\n          \"aggregations\": {\n      {{#count_with_filters}}      \"count_with_filters\": {\n              \"filter\": {\n                \"and\": {\n                  \"filters\": [\n                    {{#query}}\n                    {\n                      \"query\": {\n                        \"simple_query_string\": {\n                          \"query\": \"{{query}}\",\n                          \"fields\": [\n                            \"sys_description\", \"sys_tags\", \"sys_contributors.fulltext\", \"sys_project_name\", \"sys_title\",\"sys_content_plaintext\",\"answers.body\" \n                          ]\n                        }\n                      }\n                    },\n                    {{/query}}\n              {{#blogbyurl}}\n                    {\n                      \"or\": [\n                    {\n                      \"not\": {\n                        \"term\": { \"sys_type\" : \"blogpost\" }\n                      }\n                    },\n                    {\n                      \"and\": [\n                          {\"term\":{\"sys_url_view\":\"{{blogbyurl}}\"}},\n                          {\"term\":{\"sys_type\":\"blogpost\"}},\n\n                          {}\n                        ]\n                      },\n                        {}\n                      ]\n                    },\n                    {{/blogbyurl}}\n       {{#level}}\n                    {\n                      \"term\": { \"level\": \"{{level}}\" }\n                    },\n                    {{/level}}\n                   {{#tags_or_logic}}\n                    {\n                      \"or\": [\n                    {{/tags_or_logic}}\n                      {{#tag}}\n                      {\n                        \"term\": { \"sys_tags\": [\"{{.}}\"] }\n                      },\n                      {{/tag}}\n                    {{#tags_or_logic}}\n                      {}\n                      ]\n                    },\n                    {{/tags_or_logic}}\n                 {{#publish_date_from}}\n                    {\n                      \"range\": {\n                        \"sys_created\": { \"gte\": \"{{publish_date_from}}\" }\n                      }\n                    },\n                    {{/publish_date_from}}\n         {{#publish_date_to}}\n                    {\n                      \"range\": {\n                        \"sys_created\": {\n                          \"lte\": \"{{publish_date_to}}\"\n                        }\n                      }\n                    },\n                    {{/publish_date_to}}\n          {{#activity_interval}}\n                    {\n                      \"range\": {\n                        \"sys_activity_dates\": {\n                          \"gte\": \"{{activity_interval}}\"\n                        }\n                      }\n                    },\n                    {{/activity_interval}}\n           {{#activity_date_from}}\n                    {\n                      \"range\": {\n                        \"sys_activity_dates\": {\n                          \"gte\": \"{{activity_date_from}}\"\n                        }\n                      }\n                    },\n                    {{/activity_date_from}}\n                    {{#activity_date_to}}\n                    {\n                      \"range\": {\n                        \"sys_activity_dates\": {\n                          \"lte\": \"{{activity_date_to}}\"\n                        }\n                      }\n                    },\n                    {{/activity_date_to}}\n                    {{#rating}}\n                    {\n                      \"range\": {\n                        \"sys_rating_avg\": { \"gte\": \"{{rating}}\"}\n                      }\n                    },\n                    {{/rating}}\n                    {\n                      \"or\": [\n                        {{#sys_type}}\n                        {\n                          \"script\": {\n                            \"script\": \"(format_selection == 'quickstart_early_access' && _source.sys_type == 'quickstart' && _source.experimental != undefined && _source.experimental != null && _source.experimental === true) || (format_selection == 'quickstart' && _source.sys_type == format_selection && _source.experimental !== true) || (format_selection != 'quickstart' && format_selection != 'quickstart_early_access' && _source.sys_type == format_selection)\",\n                            \"params\": {\n                              \"format_selection\": \"{{.}}\",\n                              \"lang\": \"js\"\n                            }\n                          }\n                        },\n                        {{/sys_type}}\n                        {}\n                      ]\n                    },\n                    {\n                      \"or\": [\n                        {{#project}}\n                        {\n                          \"term\": { \"sys_project\": \"{{.}}\" }\n                        },\n                        {{/project}}\n                        {}\n                      ]\n                    },\n                    {\n                      \"terms\": {\n                        \"sys_content_provider\": [\n                          \"jboss-developer\",\"stackoverflow\",\"jbossorg\", \"rht\"\n                        ]\n                      }\n                    }\n                  ]\n                }\n              },\n              \"aggregations\": {\n                \"format_counts\": {\n                  \"terms\": {\n                    \"script\": \"_source.sys_type == 'quickstart' ? ( _source.experimental != undefined && _source.experimental != null && _source.experimental === true ? _source.sys_type + '_early_access' : _source.sys_type ) : _source.sys_type\",\n                    \"lang\": \"js\",\n                    \"size\": 100\n                  }\n                }\n              }\n            }    {{/count_with_filters}}    {{#count_with_filters}}{{#count_without_filters}},{{/count_without_filters}}{{/count_with_filters}}   \n     {{#count_without_filters}}       \"count_without_filters\": {\n              \"filter\": {\n                \"and\": {\n                  \"filters\": [\n                    {\n                      \"terms\": {\n                        \"sys_content_provider\": [\n                          \"jboss-developer\",\"stackoverflow\",\"jbossorg\", \"rht\"\n                        ]\n                      }\n                    }\n                  ]\n                }\n              },\n              \"aggregations\": {\n                \"format_counts\": {\n                  \"terms\": {\n                    \"script\": \"_source.sys_type == 'quickstart' ? ( _source.experimental != undefined && _source.experimental != null && _source.experimental === true ? _source.sys_type + '_early_access' : _source.sys_type ) : _source.sys_type\",\n                    \"lang\": \"js\",\n                    \"size\": 100\n                  }\n                }\n              }\n            }\n   {{/count_without_filters}}       }\n        }\n      }\n    }"
}
