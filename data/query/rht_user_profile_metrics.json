{
  "id": "rht_user_profile_metrics",
  "description": "RHT User Profile Metrics",
  "default": {
    "sys_content_type": [ "rht_user_profile" ]
  },
  "template" : "{\n    \"size\":  0,\n    \"query\": {\n        \"filtered\": {\n            \"filter\": {\n                \"and\": [\n                    { \n                        \"match_all\" : { } \n                    }\n                    {{#date_from}}\n                    , {\n                        \"range\": {\n                            \"sys_created\": {\n                                \"gte\": \"{{date_from}}\",\n                                \"time_zone\" : \"{{timezone_offset}}{{^timezone_offset}}America/New_York{{/timezone_offset}}\"\n                            }\n                        }\n                    }\n                    {{/date_from}}\n                    {{#date_to}}\n                    , {\n                        \"range\": {\n                            \"sys_created\": {\n                                \"lt\": \"{{date_to}}\",\n                                \"time_zone\" : \"{{timezone_offset}}{{^timezone_offset}}America/New_York{{/timezone_offset}}\"\n                            }\n                        }\n                    }\n                    {{/date_to}}\n                ]\n            }\n        }\n    },\n    \"aggs\": {\n        \"first_access_agg_{{website}}{{^website}}rhd{{/website}}\": {\n            \"date_histogram\": {\n                \"field\": \"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessTimestamp\",\n                \"order\": { \"_key\": \"asc\" },\n                \"interval\" : \"{{interval}}{{^interval}}month{{/interval}}\",\n                \"format\": \"{{bucket_key_format}}{{^bucket_key_format}}yyyy-MM{{/bucket_key_format}}\",\n                \"pre_zone\" : \"{{timezone_offset}}{{^timezone_offset}}America/New_York{{/timezone_offset}}\"\n            }\n        }\n    }\n}"
}
