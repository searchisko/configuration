{
  "id": "rht_user_profile_metrics",
  "description": "RHT User Profile Metrics",
  "default": {
    "sys_content_type": [ "rht_user_profile" ]
  },
  "template" : "{\"size\":0,\"query\":{\"filtered\":{\"filter\":{\"and\":[{\"match_all\":{}}{{#date_from}},{\"range\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessTimestamp\":{\"gte\":\"{{date_from}}\",\"time_zone\":\"{{timezone_offset}}{{^timezone_offset}}America/New_York{{/timezone_offset}}\"}}}{{/date_from}}{{#date_to}},{\"range\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessTimestamp\":{\"lt\":\"{{date_to}}\",\"time_zone\":\"{{timezone_offset}}{{^timezone_offset}}America/New_York{{/timezone_offset}}\"}}}{{/date_to}}]}}},\"aggs\":{\"user_account_type_agg\":{\"terms\":{\"field\":\"userAccountType\"}},\"social_links_count_agg\":{\"terms\":{\"field\":\"numOfSocialLinks\"}},{{#country_agg}}\"country_agg\":{\"terms\":{\"field\":\"country\",\"size\":0}},{{/country_agg}}\"social_links_types_agg\":{\"terms\":{\"field\":\"accounts.domain\",\"exclude\":\"redhat.com\"}},\"subscription_agg\":{\"filters\":{\"filters\":{\"no_subscription\":{\"term\":{\"subscription.valid\":false}},\"subscription_valid\":{\"and\":[{\"term\":{\"subscription.valid\":true}},{\"range\":{\"subscription.signDate\":{\"lt\":\"now\"}}},{\"range\":{\"subscription.expirationDate\":{\"gt\":\"now\"}}}]},\"subscription_expired\":{\"and\":[{\"term\":{\"subscription.valid\":true}},{\"range\":{\"subscription.signDate\":{\"lt\":\"now\"}}},{\"range\":{\"subscription.expirationDate\":{\"lt\":\"now\"}}}]}}}},\"rhd_members\":{\"filter\":{\"exists\":{\"field\":\"regInfo.rhd\"}},\"aggs\":{\"rhdmin\":{\"filter\":{\"and\":[{\"term\":{\"ppLevels.rhdmin\":true}},{\"missing\":{\"field\":\"ppLevels.rhdfull\"}}]}},\"rhdfull\":{\"filter\":{\"term\":{\"ppLevels.rhdfull\":true}}},\"no_valid_level\":{\"filter\":{\"and\":[{\"missing\":{\"field\":\"ppLevels.rhdmin\"}}]}}}},\"first_access_agg\":{\"date_histogram\":{\"field\":\"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessTimestamp\",\"order\":{\"_key\":\"asc\"},\"interval\":\"{{interval}}{{^interval}}month{{/interval}}\",\"format\":\"{{bucket_key_format}}{{^bucket_key_format}}yyyy-MM{{/bucket_key_format}}\",\"pre_zone\":\"{{timezone_offset}}{{^timezone_offset}}America/New_York{{/timezone_offset}}\"},\"aggs\":{ {{#country_agg}}\"by_country\":{\"terms\":{\"field\":\"country\",\"size\":0}},{{/country_agg}}\"by_email_verified\":{\"filters\":{\"filters\":{\"verified\":{\"term\":{\"emailVerified\":true}},\"not_verified\":{\"or\":[{\"term\":{\"emailVerified\":false}},{\"missing\":{\"field\":\"emailVerified\"}}]}}}},\"by_channel\":{\"filters\":{\"filters\":{\"website\":{\"and\":[{\"or\":[{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.channel\":\"website\"}},{\"and\":[{\"missing\":{\"field\":\"regInfo.{{website}}{{^website}}rhd{{/website}}.channel\"}},{\"not\":{\"terms\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.aTacticIDExternal\":[\"7016000000122iAAAQ\",\"7016000000122iKAAQ\",\"701f2000000tjnwAAA\",\"701f2000000RieJAAS\"]}}}]}]},{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessByExistingAccount\":false}}]},\"website_from_rh\":{\"and\":[{\"or\":[{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.channel\":\"website\"}},{\"and\":[{\"missing\":{\"field\":\"regInfo.{{website}}{{^website}}rhd{{/website}}.channel\"}},{\"not\":{\"terms\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.aTacticIDExternal\":[\"7016000000122iAAAQ\",\"7016000000122iKAAQ\",\"701f2000000tjnwAAA\",\"701f2000000RieJAAS\"]}}}]}]},{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessByExistingAccount\":true}}]},\"website_from_rhd\":{\"and\":[{\"or\":[{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.channel\":\"website\"}},{\"and\":[{\"missing\":{\"field\":\"regInfo.{{website}}{{^website}}rhd{{/website}}.channel\"}},{\"not\":{\"terms\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.aTacticIDExternal\":[\"7016000000122iAAAQ\",\"7016000000122iKAAQ\",\"701f2000000tjnwAAA\",\"701f2000000RieJAAS\"]}}}]}]},{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessByExistingAccount\":true}},{\"script\":{\"script\":\"(_source.regInfo.rhd != null && !_source.regInfo.rhd.firstAccessTimestamp.empty) ? _source.regInfo.rhd.firstAccessTimestamp < _source.regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessTimestamp : 1<0\"}}]},\"infoq\":{\"and\":[{\"or\":[{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.channel\":\"infoq\"}},{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.aTacticIDExternal\":\"7016000000122iAAAQ\"}}]},{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessByExistingAccount\":false}}]},\"infoq_from_rh\":{\"and\":[{\"or\":[{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.channel\":\"infoq\"}},{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.aTacticIDExternal\":\"7016000000122iAAAQ\"}}]},{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessByExistingAccount\":true}}]},\"dzone\":{\"and\":[{\"or\":[{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.channel\":\"dzone\"}},{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.aTacticIDExternal\":\"7016000000122iKAAQ\"}}]},{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.channel\":\"dzone\"}},{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessByExistingAccount\":false}}]},\"dzone_from_rh\":{\"and\":[{\"or\":[{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.channel\":\"dzone\"}},{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.aTacticIDExternal\":\"7016000000122iKAAQ\"}}]},{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessByExistingAccount\":true}}]},\"conference\":{\"and\":[{\"or\":[{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.channel\":\"conference\"}},{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.aTacticIDExternal\":\"701f2000000tjnwAAA\"}}]},{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessByExistingAccount\":false}}]},\"conference_from_rh\":{\"and\":[{\"or\":[{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.channel\":\"conference\"}},{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.aTacticIDExternal\":\"701f2000000tjnwAAA\"}}]},{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessByExistingAccount\":true}}]},\"bulkinvite\":{\"and\":[{\"or\":[{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.channel\":\"bulkinvite\"}},{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.aTacticIDExternal\":\"701f2000000RieJAAS\"}}]},{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessByExistingAccount\":false}}]},\"bulkinvite_from_rh\":{\"and\":[{\"or\":[{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.channel\":\"bulkinvite\"}},{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.aTacticIDExternal\":\"701f2000000RieJAAS\"}}]},{\"term\":{\"regInfo.{{website}}{{^website}}rhd{{/website}}.firstAccessByExistingAccount\":true}}]}}}}}}}}"
}
