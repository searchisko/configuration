{
  "id" : "contributor_profiles",
  "description" : "Query contributor profiles. Accepts the following parameters: 'query', 'contributor'.",
  "default" : {
    "sys_type" : "contributor_profile"
  },
  "override" : {
    "sys_content_type" : "source"
  },
  "template" : "{ {{#total}} \"size\":0, {{/total}} \n {{^total}} \"size\": 30,{{/total}} \n \"fields\": [ \"sys_contributors\", \"sys_title\", \"sys_url_view\" ],\"script_fields\": {\"accounts\": {\"script\": \"(_source.accounts && _source.accounts.length > 0 ) ? _source.accounts[0] : ''\" }},\"query\": {\n              \"filtered\": { \n \"filter\" : {\n                \"and\": {\n                  \"filters\": [\n                    {{#contributor}}\n                    {\n                      \"terms\": {\n                        \"sys_contributors\": [\n                          {{#contributor}}\n                          \"{{.}}\",\n                          {{/contributor}}\n                          {}\n                        ]\n                      }\n                    },\n                    {{/contributor}}\n                    {{#date_from}}\n                    {\n                      \"range\": {\n                        \"sys_created\": {\n                          \"gte\": \"{{date_from}}\",\n                          \"time_zone\" : \"{{timezone_offset}}{{^timezone_offset}}America/New_York{{/timezone_offset}}\"\n                        }\n                      }\n                    },\n                    {{/date_from}}\n                    {{#date_to}}\n                    {\n                      \"range\": {\n                        \"sys_created\": {\n                          \"lt\": \"{{date_to}}\",\n                          \"time_zone\" : \"{{timezone_offset}}{{^timezone_offset}}America/New_York{{/timezone_offset}}\"\n                        }\n                      }\n                    },\n                    {{/date_to}}\n                    {}\n                  ]\n              } \n  },\"query\": { {{#query}} \"simple_query_string\": {\"fields\": [\"sys_contributors.fulltext\", \"sys_title\"],\"query\": \"{{query}}\", \"default_operator\": \"and\" } {{/query}} {{^query}} \"match_all\": {} {{/query}} }}}   {{#aggregate}},\"aggs\" : {\n              \"bucketed\" : {\n                \"date_histogram\" : {\n                  \"field\" : \"{{date_field}}{{^date_field}}sys_created{{/date_field}}\",\n                  \"interval\" : \"{{interval}}{{^interval}}month{{/interval}}\",\n                  \"pre_zone\" : \"{{timezone_offset}}{{^timezone_offset}}America/New_York{{/timezone_offset}}\"\n                }\n        ,\n                \"aggs\" : { \n                  {{#by_country}}\n                  \"by_country\" : { \n                      \"terms\" : { \n                        \"field\" : \"country\",\n                        \"size\" : \"0\"\n                      }\n                    }\n                    {{#by_company}},{{/by_company}}\n                  {{/by_country}}\n                  {{#by_company}}\n                  \"by_company\" : { \n                    \"terms\" : {\n                      \"field\" : \"company\",\n                      \"size\" : \"0\"\n                    }\n                  }\n                  {{/by_company}}\n                }      }\n            }{{/aggregate}} }"
}
